p56 <- FeaturePlot(epi,
reduction = "tsne",
features = "bc_ratio") +
theme_yehlab() +
NoLegend()+
labs(title = "Basal:Classical Ratio") +
theme(axis.title = element_blank())
p57 <- FeaturePlot(epi,
reduction = "tsne",
features = "basal_tumor") +
theme_yehlab() +
labs(title = "Basal") +
NoLegend()+
theme(axis.title = element_blank())
p58 <- (p55 | p56 | p57) / p49
p58
epi@meta.data$label <- case_when(epi@meta.data$seurat_clusters == 0 ~ "Classical 1",
epi@meta.data$seurat_clusters == 1 ~ "Secretory",
epi@meta.data$seurat_clusters == 2 ~ "Basal",
epi@meta.data$seurat_clusters == 3 ~ "Lipid processing",
epi@meta.data$seurat_clusters == 4 ~ "Classical 2")
p59 <- DimPlot(epi,
reduction = "tsne",
group.by = "label") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p59
p59 <- DimPlot(epi,
reduction = "tsne",
group.by = "label") +
xlab("t-SNE 1") +
ylab("t-SNE 2") #+
#annotate("label", )
p59
p59 <- DimPlot(epi,
reduction = "tsne",
group.by = "label") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
annotate(geom = "label", label = "Basal", x = -10, y = 40) +
annotate(geom = "label", label = "Classical 1", x = 10, y = -20) +
annotate(geom = "label", label = "Classical 2", x = -30, y = 5) +
annotate(geom = "label", label = "Lipid processing", x = 20, y = 30) +
annotate(geom = "label", label = "Secretory", x = -40, y = -15)
p59
p59 <- DimPlot(epi,
reduction = "tsne",
group.by = "label") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
annotate(geom = "label", label = "Basal", x = -10, y = 37) +
annotate(geom = "label", label = "Classical 1", x = 10, y = -20) +
annotate(geom = "label", label = "Classical 2", x = -25, y = 3) +
annotate(geom = "label", label = "Lipid processing", x = 20, y = 27) +
annotate(geom = "label", label = "Secretory", x = -40, y = -15)
p59
p59 <- DimPlot(epi,
reduction = "tsne",
group.by = "label") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
annotate(geom = "label", label = "Basal", x = -10, y = 37) +
annotate(geom = "label", label = "Classical 1", x = 10, y = -15) +
annotate(geom = "label", label = "Classical 2", x = -25, y = 3) +
annotate(geom = "label", label = "Lipid processing", x = 20, y = 27) +
annotate(geom = "label", label = "Secretory", x = -40, y = -15)
p59
fig_path <- "/Volumes/labs/Home/Jen Jen Yeh Lab/Jack/Reclustering Project/Figures/PBMC3k/"
ggsave(plot = p49,
filename = "Epithelial/Epi_SCISSORS.pdf",
path = fig_path,
device = "pdf",
width = 8,
height = 6,
units = "in")
fig_path <- "/Volumes/labs/Home/Jen Jen Yeh Lab/Jack/Reclustering Project/Figures/Elyada All/"
ggsave(plot = p49,
filename = "Epithelial/Epi_SCISSORS.pdf",
path = fig_path,
device = "pdf",
width = 8,
height = 6,
units = "in")
p54
p54 <- p50 + p51 + p52 + p53 + plot_layout(nrow = 2,
ncol = 2,
byrow = TRUE)
p54
p50 <- FeaturePlot(epi,
reduction = "tsne",
features = "CEACAM6") +
theme_yehlab() +
NoLegend()+
theme(axis.title = element_blank())
p51 <- FeaturePlot(epi,
reduction = "tsne",
features = "FABP1") +
theme_yehlab() +
NoLegend()+
theme(axis.title = element_blank())
p52 <- FeaturePlot(epi,
reduction = "tsne",
features = "SOD3") +
theme_yehlab() +
NoLegend()+
xlab("t-SNE 1") +
xlab("t-SNE 2")
p53 <- FeaturePlot(epi,
reduction = "tsne",
features = "CRISP3") +
theme_yehlab() +
NoLegend()+
theme(axis.title = element_blank())
p54 <- p50 + p51 + p52 + p53 + plot_layout(nrow = 2,
ncol = 2,
byrow = TRUE)
p54
ggsave(plot = p54,
filename = "Epithelial/Epi_marker_genes.pdf",
path = fig_path,
device = "pdf",
width = 8,
height = 6,
units = "in")
ggsave(plot = p58,
filename = "Epithelial/Epi_basal_classical_DECODER.pdf",
path = fig_path,
device = "pdf",
width = 8,
height = 6,
units = "in")
p59 <- DimPlot(epi,
reduction = "tsne",
group.by = "label") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab() +
NoLegend() +
annotate(geom = "label", label = "Basal", x = -10, y = 37) +
annotate(geom = "label", label = "Classical 1", x = 10, y = -15) +
annotate(geom = "label", label = "Classical 2", x = -25, y = 3) +
annotate(geom = "label", label = "Lipid processing", x = 20, y = 27) +
annotate(geom = "label", label = "Secretory", x = -40, y = -15)
p59
ggsave(plot = p59,
filename = "Epithelial/Epi_final_cell_labels.pdf",
path = fig_path,
device = "pdf",
width = 8,
height = 6,
units = "in")
rm(epi_reclust)
saveRDS(epi, file = "~/Desktop/Elyada_epi.Rds")
saveRDS(epi, file = "/Volumes/labs/Home/Jen Jen Yeh Lab/Jack/Reclustering Project/Seurat Objects/Elyada All/Elyada_epi.Rds")
knitr::opts_chunk$set(echo = TRUE,
message = FALSE,
warning = FALSE)
theme_yehlab <- function() {
theme(axis.ticks = element_blank(),
axis.text = element_blank(),
axis.line = element_blank(),
panel.grid = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", linetype = 1, size = 1))
}
library(SCISSORS)
library(Seurat)
library(SeuratData)
library(ggplot2)
library(dplyr)
library(SingleR)
pbmc <- LoadData("pbmc3k")
pbmc <- PrepareData(pbmc,
n.variable.genes = 4000,
n.PC = 10,
which.dim.reduc = "tsne",
initial.resolution = .4,
random.seed = 629)
p0 <- DimPlot(pbmc) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p0
reclust_res <- ReclusterCells(pbmc,
which.clust = list(0, 1, 3),
n.variable.genes = 4000,
n.PC = 15,
k.vals = c(10, 20, 30, 50),
resolution.vals = c(.1, .2, .3, .4),
which.dim.reduc = "tsne",
redo.embedding = TRUE,
random.seed = 629)
p1 <- DimPlot(reclust_res[[1]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p2 <- DimPlot(reclust_res[[2]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p3 <- DimPlot(reclust_res[[3]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p1
p2
p3
reclust_res <- ReclusterCells(pbmc,
which.clust = list(1, 3),
n.variable.genes = 4000,
n.PC = 15,
k.vals = c(10, 20, 30, 50),
resolution.vals = c(.1, .2, .3, .4),
which.dim.reduc = "tsne",
redo.embedding = FALSE,
random.seed = 629)
p1 <- DimPlot(reclust_res[[1]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p2 <- DimPlot(reclust_res[[2]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p1
p2
reclust_res <- ReclusterCells(pbmc,
which.clust = list(0, 1, 2),
n.variable.genes = 4000,
n.PC = 15,
k.vals = c(10, 20, 30, 50),
resolution.vals = c(.1, .2, .3, .4),
which.dim.reduc = "tsne",
redo.embedding = FALSE,
random.seed = 629)
p1 <- DimPlot(reclust_res[[1]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p2 <- DimPlot(reclust_res[[2]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p3 <- DimPlot(reclust_res[[3]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p1
p2
p3
reclust_res <- ReclusterCells(pbmc,
which.clust = list(0, 1, 2),
n.variable.genes = 4000,
n.PC = 10,
k.vals = c(10, 20, 30, 50),
resolution.vals = c(.1, .2, .3, .4),
which.dim.reduc = "tsne",
redo.embedding = FALSE,
random.seed = 629)
p1 <- DimPlot(reclust_res[[1]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p1
reclust_res <- ReclusterCells(pbmc,
which.clust = list(0, 1, 2),
n.variable.genes = 4000,
n.PC = 10,
k.vals = c(15, 25, 35, 45),
resolution.vals = c(.1, .2, .3, .4),
which.dim.reduc = "tsne",
redo.embedding = FALSE,
random.seed = 629)
p1 <- DimPlot(reclust_res[[1]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p1
p2 <- DimPlot(reclust_res[[2]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p2
p3 <- DimPlot(reclust_res[[3]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p3
reclust_res <- ReclusterCells(pbmc,
which.clust = list(0, 1, 2),
n.variable.genes = 4000,
n.PC = 10,
k.vals = c(15, 25, 35, 45),
resolution.vals = c(.1, .2, .3, .4),
which.dim.reduc = "tsne",
redo.embedding = TRUE,
random.seed = 629)
p1 <- DimPlot(reclust_res[[1]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p2 <- DimPlot(reclust_res[[2]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p3 <- DimPlot(reclust_res[[3]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p1
p2
p3
p1
p2
p3
clust_7 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[1]]@meta.data$seurat_clusters == 1, ])
clust_8 <- rownames(reclust_res[[2]]@meta.data[reclust_res[[2]]@meta.data$seurat_clusters == 1, ])
clust_9 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[3]]@meta.data$seurat_clusters == 1, ])
clust_10 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[3]]@meta.data$seurat_clusters == 2, ])
pbmc@meta.data$seurat_clusters <- case_when(rownames(pbmc) %in% clust_7 ~ 7,
rownames(pbmc) %in% clust_8 ~ 8,
rownames(pbmc) %in% clust_9 ~ 9,
rownames(pbmc) %in% clust_10 ~ 10,
TRUE ~ pbmc@meta.data$seurat_clusters)
clust_df <- data.frame(CellID = colnames(pbmc),
ClustID = as.numeric(pbmc@meta.data$seurat_clusters) - 1,
stringsAsFactors = FALSE)
clust_7 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[1]]@meta.data$seurat_clusters == 1, ])
clust_8 <- rownames(reclust_res[[2]]@meta.data[reclust_res[[2]]@meta.data$seurat_clusters == 1, ])
clust_9 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[3]]@meta.data$seurat_clusters == 1, ])
clust_10 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[3]]@meta.data$seurat_clusters == 2, ])
label <- case_when(clust_df$CellID %in% clust_8 ~ 7,
clust_df$CellID %in% clust_9 ~ 8,
clust_df$CellID %in% clust_9 ~ 9.
clust_df$CellID %in% clust_10 ~ 10,
label <- case_when(clust_df$CellID %in% clust_8 ~ 7,
clust_df$CellID %in% clust_9 ~ 8,
clust_df$CellID %in% clust_9 ~ 9,
clust_df$CellID %in% clust_10 ~ 10,
TRUE ~ clust_df$ClustID)
pbmc <- AddMetaData(pbmc,
col.name = "seurat_clusters",
metadata = as.factor(label))
Idents(pbmc) <- "seurat_clusters"
p3 <- DimPlot(pbmc) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p3
pbmc <- LoadData("pbmc3k")
pbmc <- PrepareData(pbmc,
n.variable.genes = 4000,
n.PC = 10,
which.dim.reduc = "tsne",
initial.resolution = .4,
random.seed = 629)
p0 <- DimPlot(pbmc) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p0
reclust_res <- ReclusterCells(pbmc,
which.clust = list(0, 1, 2),
n.variable.genes = 4000,
n.PC = 10,
k.vals = c(15, 25, 35, 45),
resolution.vals = c(.1, .2, .3, .4),
which.dim.reduc = "tsne",
redo.embedding = TRUE,
random.seed = 629)
p1 <- DimPlot(reclust_res[[1]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p2 <- DimPlot(reclust_res[[2]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p3 <- DimPlot(reclust_res[[3]]) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p1
p2
p3
clust_df <- data.frame(CellID = colnames(pbmc),
ClustID = as.numeric(pbmc@meta.data$seurat_clusters) - 1,
stringsAsFactors = FALSE)
clust_7 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[1]]@meta.data$seurat_clusters == 1, ])
clust_8 <- rownames(reclust_res[[2]]@meta.data[reclust_res[[2]]@meta.data$seurat_clusters == 1, ])
clust_9 <- rownames(reclust_res[[3]]@meta.data[reclust_res[[3]]@meta.data$seurat_clusters == 1, ])
clust_10 <- rownames(reclust_res[[3]]@meta.data[reclust_res[[3]]@meta.data$seurat_clusters == 2, ])
label <- case_when(clust_df$CellID %in% clust_8 ~ 7,
clust_df$CellID %in% clust_9 ~ 8,
clust_df$CellID %in% clust_9 ~ 9,
clust_df$CellID %in% clust_10 ~ 10,
TRUE ~ clust_df$ClustID)
pbmc <- AddMetaData(pbmc,
col.name = "seurat_clusters",
metadata = as.factor(label))
Idents(pbmc) <- "seurat_clusters"
p3 <- DimPlot(pbmc) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p3
clust_df <- data.frame(CellID = colnames(pbmc),
ClustID = as.numeric(pbmc@meta.data$seurat_clusters) - 1,
stringsAsFactors = FALSE)
clust_7 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[1]]@meta.data$seurat_clusters == 1, ])
clust_8 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[1]]@meta.data$seurat_clusters == 2, ])
clust_9 <- rownames(reclust_res[[2]]@meta.data[reclust_res[[2]]@meta.data$seurat_clusters == 1, ])
clust_10 <- rownames(reclust_res[[3]]@meta.data[reclust_res[[3]]@meta.data$seurat_clusters == 1, ])
label <- case_when(clust_df$CellID %in% clust_8 ~ 7,
clust_df$CellID %in% clust_9 ~ 8,
clust_df$CellID %in% clust_9 ~ 9,
clust_df$CellID %in% clust_10 ~ 10,
TRUE ~ clust_df$ClustID)
pbmc <- AddMetaData(pbmc,
col.name = "seurat_clusters",
metadata = as.factor(label))
Idents(pbmc) <- "seurat_clusters"
p3 <- DimPlot(pbmc) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p3
p1
p2
p3
clust_df <- data.frame(CellID = colnames(pbmc),
ClustID = as.numeric(pbmc@meta.data$seurat_clusters) - 1,
stringsAsFactors = FALSE)
clust_7 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[1]]@meta.data$seurat_clusters == 1, ])
clust_8 <- rownames(reclust_res[[1]]@meta.data[reclust_res[[1]]@meta.data$seurat_clusters == 2, ])
clust_9 <- rownames(reclust_res[[2]]@meta.data[reclust_res[[2]]@meta.data$seurat_clusters == 1, ])
clust_10 <- rownames(reclust_res[[3]]@meta.data[reclust_res[[3]]@meta.data$seurat_clusters == 1, ])
label <- case_when(clust_df$CellID %in% clust_7 ~ 7,
clust_df$CellID %in% clust_8 ~ 8,
clust_df$CellID %in% clust_9 ~ 9,
clust_df$CellID %in% clust_10 ~ 10,
TRUE ~ clust_df$ClustID)
pbmc <- AddMetaData(pbmc,
col.name = "seurat_clusters",
metadata = as.factor(label))
Idents(pbmc) <- "seurat_clusters"
p3 <- DimPlot(pbmc) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p3
p4 <- FeaturePlot(pbmc, features = "IL7R") +
NoLegend() +
theme_yehlab() +
theme(axis.title = element_blank())
p5 <- FeaturePlot(pbmc, features = "CCR7") +
NoLegend() +
theme_yehlab() +
theme(axis.title = element_blank())
p6 <- FeaturePlot(pbmc, features = "S100A4") +
NoLegend() +
theme_yehlab() +
theme(axis.title = element_blank())
p7 <- (p4 | p5 | p6) / p3
p7
p3
clust8_markers <- FindMarkers(pbmc, ident.1 = 8, ident.2 = 0, assay = "SCT", test.use = "wilcox", random.seed = 629)
View(clust8_markers)
clust8_markers <- FindMarkers(pbmc,
ident.1 = 8,
ident.2 = 0,
only.pos = TRUE,
logfc.threshold = 2,
assay = "SCT",
test.use = "wilcox",
random.seed = 629)
clust8_markers <- FindMarkers(pbmc,
ident.1 = 8,
ident.2 = 0,
only.pos = TRUE,
logfc.threshold = 1,
assay = "SCT",
test.use = "wilcox",
random.seed = 629)
View(clust8_markers)
clust8_markers
clust8_markers$p_val_adj[5]
clust8_markers$p_val_adj[4]
clust8_markers <- clust8_markers[clust8_markers$p_val_adj < .05, ]
clust8_markers
length(which(pbmc$seurat_clusters == 8))
FeaturePlot(pbmc, features = "IL-2")
FeaturePlot(pbmc, features = "IL2")
FeaturePlot(pbmc, features = "IL-15")
log2(.75)
log2(1)
?FindMarkers
clust8_markers <- FindMarkers(pbmc,
ident.1 = 8,
ident.2 = 0,
only.pos = TRUE,
logfc.threshold = .75,
assay = "SCT",
test.use = "wilcox",
random.seed = 629)
clust8_markers <- clust8_markers[clust8_markers$p_val_adj < .05, ]
View(clust8_markers)
clust8_markers
FeaturePlot(pbmc, features = "IFIT1")
genes = rownames(clust8_markers)
write.csv(genes, file = "~/Desktop/genes.csv")
