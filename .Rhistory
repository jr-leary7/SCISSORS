theme_yehlab()
p1
p6 <- DimPlot(pdac,
reduction = "tsne",
group.by = "SingleR.labels.bulk")  +
xlab("Fit-SNE 1") +
ylab("Fit-SNE 2") +
annotate(geom = "label", label = "B", x = -45, y = 30) +
annotate(geom = "label",label = "Epithelial", x = 33, y = 60) +
annotate(geom = "label",label = "Macrophage", x = -40, y = -20) +
annotate(geom = "label",label = "Monocyte", x = 10, y = -50) +
annotate(geom = "label",label = "MSC", x = 70, y = -20) +
annotate(geom = "label",label = "Pre-B CD34-", x = 0, y = 45) +
annotate(geom = "label",label = "T", x = 25, y = 10) +
theme_yehlab() +
NoLegend()
p6
p15
p12
p18
p16 <- FeaturePlot(fibro,
reduction = "tsne",
features = "iCAF") +
NoLegend() +
labs(title = "iCAF Enrichment") +
theme_yehlab() +
theme(axis.text = element_blank())
p17 <- FeaturePlot(fibro,
reduction = "tsne",
features = "myCAF") +
NoLegend() +
labs(title = "myCAF Enrichment") +
theme_yehlab() +
theme(axis.text = element_blank())
p18 <- (p16 | p17) / p13
p18
ggsave(plot = p18,
filename = "Fibroblasts/iCAF_myCAF_enrichment.pdf",
path = fig_path,
device = "pdf",
width = 8,
height = 6,
units = "in")
p16 <- FeaturePlot(fibro,
reduction = "tsne",
features = "iCAF") +
NoLegend() +
labs(title = "iCAF Enrichment") +
theme_yehlab() +
theme(axis.title = element_blank())
p17 <- FeaturePlot(fibro,
reduction = "tsne",
features = "myCAF") +
NoLegend() +
labs(title = "myCAF Enrichment") +
theme_yehlab() +
theme(axis.title = element_blank())
p18 <- (p16 | p17) / p13
p18
ggsave(plot = p18,
filename = "Fibroblasts/iCAF_myCAF_enrichment.pdf",
path = fig_path,
device = "pdf",
width = 8,
height = 6,
units = "in")
table(fibro$seurat_clusters)
?FindNeighbors
sqrt(ncol(fibro))
sqrt(2700)
fibro_markers <- FindAllMarkers(fibro,
assay = "SCT",
logfc.threshold = 1,
test.use = "wilcox",
only.pos = TRUE,
random.seed = 629)
fibro_markers <- FindAllMarkers(fibro,
assay = "SCT",
logfc.threshold = 2,
test.use = "wilcox",
only.pos = TRUE,
random.seed = 629)
View(fibro_markers)
DimPlot(fibro, reduction = "tsne")
View(fibro_markers)
FeaturePlot(fibro, features = "SPP1", reduction = "tsne")
FeaturePlot(fibro, features = "MMP7", reduction = "tsne")
FeaturePlot(fibro, reduction = "tsne", features = "MIF")
FeaturePlot(fibro, reduction = "tsne", features = "CD79A")
FeaturePlot(fibro, reduction = "tsne", features = "MS4A1")
FeaturePlot(fibro, reduction = "tsne", features = "KRT18")
FeaturePlot(fibro, reduction = "tsne", features = "KRT8")
FeaturePlot(fibro, reduction = "tsne", features = "TFF1")
FeaturePlot(fibro, reduction = "tsne", features = "LYZ")
FeaturePlot(fibro, reduction = "tsne", features = "APOE")
FeaturePlot(fibro, reduction = "tsne", features = "HLA-DRA")
FeaturePlot(fibro, reduction = "tsne", features = "C1QA")
FeaturePlot(fibro, reduction = "tsne", features = "CD14")
FeaturePlot(fibro, reduction = "tsne", features = "CD3D")
FeaturePlot(fibro, reduction = "tsne", features = "CD2")
FeaturePlot(fibro, reduction = "tsne", features = "NKG7")
FeaturePlot(fibro, reduction = "tsne", features = "IGFBP7")
FeaturePlot(fibro, reduction = "tsne", features = "ACTA2")
FeaturePlot(fibro, reduction = "tsne", features = "PRSS1")
FeaturePlot(fibro, reduction = "tsne", features = "CTRB2")
FeaturePlot(fibro, reduction = "tsne", features = "REG1A")
FeaturePlot(fibro, reduction = "tsne", features = "MMP7")
FeaturePlot(fibro, reduction = "tsne", features = "CLU")
FeaturePlot(fibro, reduction = "tsne", features = "SPP1")
FeaturePlot(fibro, reduction = "tsne", features = "IGJ")
FeaturePlot(fibro, reduction = "tsne", features = "IGLL5")
FeaturePlot(fibro, reduction = "tsne", features = "IRF7)
FeaturePlot(fibro, reduction = "tsne", features = "IRF7)
FeaturePlot(fibro, reduction = "tsne", features = "IRF7")
FeaturePlot(fibro, reduction = "tsne", features = "GZMB")
FeaturePlot(fibro, reduction = "tsne", features = "CCL22")
FeaturePlot(fibro, reduction = "tsne", features = "LAMP3")
FeaturePlot(fibro, reduction = "tsne", features = "PLVAP")
FeaturePlot(fibro, reduction = "tsne", features = "TPSAB1")
FeaturePlot(fibro, reduction = "tsne", features = "CPA3")
FeaturePlot(fibro, reduction = "tsne", features = "HBB")
FeaturePlot(fibro, reduction = "tsne", features = "HBA2")
FeaturePlot(fibro, reduction = "tsne", features = "KRT19")
FeaturePlot(fibro, reduction = "tsne", features = "SPINK1")
p25
p4 <- DimPlot(pdac, reduction = "fitsne_kern") +
xlab("Fit-SNE 1") +
ylab("Fit-SNE 2") +
theme_yehlab()
p4
rownames(sc_preds))]
p5 <- DimPlot(pdac,
reduction = "tsne",
group.by = "SingleR.labels.sc") +
xlab("Fit-SNE 1") +
ylab("Fit-SNE 2") +
annotate(geom = "label", label = "Acinar", x = 75, y = 30) +
annotate(geom = "label",label = "Ductal", x = 33, y = 60) +
annotate(geom = "label",label = "Activated Stellate", x = 70, y = -20) +
annotate(geom = "label",label = "Macrophage", x = -25, y = -30) +
annotate(geom = "label",label = "T", x = 10, y = 10) +
theme_yehlab() +
NoLegend()
p5
p13
p15
p18
p22
p25
FeaturePlot(fibro, reduction = "tsne". features = "ACTA2")
FeaturePlot(fibro, reduction = "tsne", features = "ACTA2")
View(fibro_markers)
FeaturePlot(fibro, features = "percent_MT")
FeaturePlot(fibro, features = "percent_MT", reduction = "tsne")
FeaturePlot(fibro, features = "nCount_RNA", reduction = "tsne")
FeaturePlot(fibro, features = "nCount_SCT", reduction = "tsne")
mean(fibro$nCount_RNA)
mean(fibro$nFeature_RNA)
FeaturePlot(fibro, features = "nFeature_SCT", reduction = "tsne")
mean(fibro$nCount_SCT)
mean(fibro$nFeature_SCT)
colnames(fibro@meta.data)
t=subset(fibro, subset = seurat_clusters == 4)
mean(t$nFeature_SCT)
mean(t$nCount_SCT)
FeaturePlot(fibro, features = "nCount_SCT", reduction = "tsne")
dim(t)
mean(t$percent_MT)
mean(t$nCount_VAM.cdf)
mean(t$nFeature_VAM.cdf)
mean(t@assays$VAM.cdf@data@x)
DimPlot(fibro, reduction = "tsne", group.by = "sample")
table(t$sample)
DimPlot(fibro, reduction = "tsne", group.by = "sex")
table(t$sex)
20/22
table(fibro$sex)
dim(fibro)
1387/1630
DimPlot(fibro, reduction = "tsne", group.by = "condition")
table(t$condition)
14/22
frequency(t$sex)
DimPlot(fibro, reduction = "tsne", group.by = "SingleR.labels.sc")
DimPlot(fibro, reduction = "tsne", group.by = "SingleR.labels.bulk")
?SingleR
fibro_preds <- SingleR(test = data.frame(fibro@assays$SCT@data),
ref = bulk_ref,
labels = bulk_ref$label.fine,
method = "single",
de.method = "wilcox")
bulk_ref <- HumanPrimaryCellAtlasData()
fibro_preds <- SingleR(test = data.frame(fibro@assays$SCT@data),
ref = bulk_ref,
labels = bulk_ref$label.fine,
method = "single",
de.method = "wilcox")
fibro_preds <- SingleR(test = data.frame(fibro@assays$SCT@data),
ref = bulk_ref,
labels = bulk_ref$label.fine,
method = "cluster",
de.method = "wilcox")
clust4 <- subset(fibro, subset = seurat_clusters == 4)
clust4_preds <- SingleR(test = data.frame(clust4@assays$SCT@data),
ref = bulk_ref,
labels = bulk_ref$label.main,
method = "single",
clusters = clust4$seurat_clusters,
de.method = "wilcox")
clust4_preds <- SingleR(test = data.frame(clust4@assays$SCT@data),
ref = bulk_ref,
labels = bulk_ref$label.main,
method = "single",
de.method = "wilcox")
clust4_preds <- SingleR(test = data.frame(clust4@assays$SCT@data),
ref = bulk_ref,
labels = bulk_ref$label.fine,
method = "cluster",
clusters = clust4$seurat_clusters,
de.method = "wilcox")
DimPlot(fibro, CD74)
DimPlot(fibro, reduction = "tsne", features = "CD74")
FeaturePlot(fibro, reduction = "tsne", features = "CD74")
FeaturePlot(fibro, reduction = "tsne", features = "SAA3")
FeaturePlot(fibro, reduction = "tsne", features = "SLPI")
FeaturePlot(fibro, reduction = "tsne", features = "KRT8")
rm(clust4)
rm(t)
View(fibro_markers)
FeaturePlot(fibro, reduction = "tsne", features = "H2-AB1")
FeaturePlot(fibro, reduction = "tsne", features = "HLA-DQB1")
FeaturePlot(fibro, features = "SLPI", reduction = "tsne")
apcaf_genes <- c("HLA-DQB1", "CD74", "SAA3P", "SLPI")
gene_sets <- list(icaf_genes, mycaf_genes, apcag_genes, pan_caf_genes)
gene_sets <- list(icaf_genes, mycaf_genes, apcaf_genes, pan_caf_genes)
names(gene_sets) <- c("iCAF", "myCAF", "apCAF", "Pan-CAF")
for (i in seq(gene_sets)) {
gene_sets[[i]] <- gene_sets[[i]][gene_sets[[i]] %in% rownames(fibro)]
}
fibro <- vamForSeurat(fibro, gene.set.collection = gene_sets)
DefaultAssay(fibro) <- "VAM.cdf"
p26 <- FeaturePlot(fibro,
reduction = "tsne",
features = "apCAF") +
NoLegend() +
labs(title = "apCAF Enrichment") +
theme_yehlab() +
theme(axis.title = element_blank())
p26
p26
p27 <- (p16 | p17 | p25) / p13
p27
p27 <- (p16 | p17 | p26) / p13
p27
p27
p26
p26
fibro@meta.data$label <- case_when(fibro@meta.data$seurat_clusters == 0 ~ "myCAF",
fibro@meta.data$seurat_clusters == 1 ~ "Perivascular",
fibro@meta.data$seurat_clusters == 2 ~ "iCAF",
fibro@meta.data$seurat_clusters == 3 ~ "Endothelial",
fibro@meta.data$seurat_clusters == 4 ~ "apCAF")
DimPlot(fibro, group.by = "label") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme(axis.ticks = element_blank())
p28 <- DimPlot(fibro,
reduction = "tsne",
group.by = "label") +
xlab("Fit-SNE 1") +
ylab("Fit-SNE 2") +
theme_yehlab()
p28
ggsave(plot = p26,
filename = "Fibroblasts/apCAF_enrichment.pdf",
path = fig_path,
device = "pdf",
width = 8,
height = 6,
units = "in")
ggsave(plot = p28,
filename = "Fibroblasts/Final_cell_labels.pdf",
path = fig_path,
device = "pdf",
width = 8,
height = 6,
units = "in")
saveRDS(fibro, file = "/Volumes/labs/Home/Jen Jen Yeh Lab/Jack/Reclustering Project/Seurat Objects/Elyada All/Elyada_fibro.Rds")
fibro_markers[fibro_markers$cluster == 4, ]
fibro_markers[fibro_markers$cluster == 4, ]
fibro_markers[fibro_markers$cluster == 4, ]
p28
p5
p6
p5
p6
p4
p5
p6
(p5 | p6) / p4
nkt <- subset(pdac, subset == seurat_cluster %in% c(0, 3, 8))
nkt <- subset(pdac, subset == seurat_clusters %in% c(0, 3, 8))
nkt <- subset(pdac, subset = seurat_clusters %in% c(0, 3, 8))
DimPlot(nkt, reduction = "tsne")
p4 + p5
nkt <- subset(pdac, subset = seurat_clusters %in% c(0, 3, 9))
DimPlot(nkt, reduction = "tsne")
p29 <- FeaturePlot(nkt,
reduction = "tsne",
features = "CD3D") +
theme_yehlab() +
theme(axis.title = element_blank())
p29
p29 <- FeaturePlot(nkt,
reduction = "tsne",
features = "CD3D") +
theme_yehlab() +
NoLegend() +
theme(axis.title = element_blank())
p30 <- FeaturePlot(nkt,
reduction = "tsne",
features = ";CD2") +
theme_yehlab() +
NoLegend() +
theme(axis.title = element_blank())
p29 <- FeaturePlot(nkt,
reduction = "tsne",
features = "CD3D") +
theme_yehlab() +
NoLegend() +
theme(axis.title = element_blank())
p30 <- FeaturePlot(nkt,
reduction = "tsne",
features = "CD2") +
theme_yehlab() +
NoLegend() +
theme(axis.title = element_blank())
p31 <- FeaturePlot(nkt,
reduction = "tsne",
features = "NKG7") +
theme_yehlab() +
NoLegend() +
theme(axis.title = element_blank())
p32 <- DimPlot(nkt, reduction = "tsne") +
xlab("Fit-SNE 1") +
ylab("Fit-SNE 2") +
theme_yehlab()
p33 <- (p29 | p30 | p31) / p32
p33
p31
p32
p29 <- FeaturePlot(nkt,
reduction = "tsne",
features = "NKG7") +
theme_yehlab() +
NoLegend() +
theme(axis.title = element_blank())
p30 <- DimPlot(nkt, reduction = "tsne") +
xlab("Fit-SNE 1") +
ylab("Fit-SNE 2") +
theme_yehlab()
p29 + p30
p29 | p30
p29 / p30
p31 <- p29 / p30
p31
devtools::document()
t_reclust <- ReclusterCells(pdac,
which.clust = list(3, 9),
merge.clusters = TRUE,
n.variable.genes = 4000,
n.PC = 20,
which.dim.reduc = "tsne",
redo.embedding = FALSE,
random.seed = 629)
tcells <- t_reclust[[1]]
DimPlot(tcells) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme(axis.ticks = element_blank())
DimPlot(tcells, reduction = "tsne") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme(axis.ticks = element_blank())
length(t_reclust)
t_reclust <- ReclusterCells(pdac,
which.clust = list(3, 9),
merge.clusters = TRUE,
n.variable.genes = 4000,
n.PC = 20,
which.dim.reduc = "tsne",
redo.embedding = TRUE,
random.seed = 629)
tcells <- t_reclust[[1]]
DimPlot(tcells, reduction = "tsne") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme(axis.ticks = element_blank())
DimPlot(tcells, reduction = "tsne") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p32 <- DimPlot(tcells, reduction = "tsne") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
p32
FeaturePlot(tcells, features = c("CD8A")) +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
FeaturePlot(tcells,
reduction = "tsne",
features = "CD8A") +
xlab("t-SNE 1") +
ylab("t-SNE 2") +
theme_yehlab()
DimPlot(fibro, group.by = "label")
DimPlot(fibro, reduction = "tsne_orig", group.by = "label")
DimPlot(fibro, group.by = "label")
DimPlot(fibro, reduction = "tsne_orig", group.by = "label")
library(CONICSmat)
chrom_regions <- read.table("/Volumes/labs/Home/Jen Jen Yeh Lab/Jack/scRNAseq/chrom_arm_positions.txt")
View(chrom_regions)
chrom_regions <- read.table("/Volumes/labs/Home/Jen Jen Yeh Lab/Jack/scRNAseq/chrom_arm_positions.txt",
sep = "\t",
row.names = 1,
header = TRUE)
View(chrom_regions)
rm(fibro)
rm(t_reclust)
rm(nkt)
rm(fibro_markers)
rm(fibro_reclust)
head(rownames(pdac))
gene_pos <- getGenePositions(rownames(pdac))
dim(pdac)
dim(pdac@assays$SCT@data)
rm(bulk_ref)
rm(sc_ref)
rm(gene_sets)
rm(icaf_genes, apcaf_genes)
rm(mycaf_genes)
rm(pan_caf_genes)
rm(i)
norm_factor <- calcNormFactors(as.matrix(pdac@assays$SCT@data))
cnv_est <- plotAll(as.matrix(pdac@assays$SCT@data),
normFactor = norm_factor,
regions = chrom-regions,
gene_pos = gene_pos,
fname = "Elyada_CNVs")
cnv_est <- plotAll(as.matrix(pdac@assays$SCT@data),
normFactor = norm_factor,
regions = chrom_regions,
gene_pos = gene_pos,
fname = "Elyada_CNVs")
hist1 <- plotHistogram(cnv_est,
as.matrix(pdac@assays$SCT@data),
clusters = 2,
zscoreThreshold = 3,
patients = pdac$sample)
rm(tcells)
hist1 <- plotHistogram(cnv_est,
as.matrix(pdac@assays$SCT@data),
clusters = 2,
zscoreThreshold = 3,
patients = pdac$sample)
rm(p1, p2, p3, p7, p8, p9, p10, p11, p12, p13, p14, p15)
rm(p16, p17, p18, p19, p20, p21, p22, p23)
rm(p24, p25, p26, p27)
rm(p28, p29, p30, p31, p32)
rm(p33)
rm(p4, p5, p6)
hist1 <- plotHistogram(cnv_est,
as.matrix(pdac@assays$SCT@data),
clusters = 2,
zscoreThreshold = 3,
patients = pdac$sample)
bic_table <- read.table("./Elyada_CNVs_BIC_LR.txt",
sep = "\t",
row.names = 1,
header = TRUE,
check.names = FALSE)
cand_regions <- rownames(bic_table[bic_table$`BIC difference` > 200 & bic_table$`LRT adj. p-val` < .05, ])
cand_regions <- rownames(bic_table[bic_table$`BIC difference` > 200 & bic_table$`LRT adj. p-val` < .01, ])
cand_regions <- rownames(bic_table[bic_table$`BIC difference` > 300 & bic_table$`LRT adj. p-val` < .01, ])
cand_regions
cand_regions <- rownames(bic_table[bic_table$`BIC difference` > 500 & bic_table$`LRT adj. p-val` < .01, ])
cand_regions <- rownames(bic_table[bic_table$`BIC difference` > 500 & bic_table$`LRT adj. p-val` < .005, ])
cand_regions <- rownames(bic_table[bic_table$`BIC difference` > 500 & bic_table$`LRT adj. p-val` < .01, ])
hist1 <- plotHistogram(cnv_est[, cand_regions],
as.matrix(pdac@assays$SCT@data),
clusters = 2,
zscoreThreshold = 3,
patients = pdac$sample)
rm(chrom_regions)
hist1 <- plotHistogram(cnv_est[, cand_regions],
as.matrix(pdac@assays$SCT@data),
clusters = 2,
zscoreThreshold = 3,
patients = pdac$sample)
saveRDS(pdac, file = "~/Desktop/Elyada.Rds")
knitr::opts_chunk$set(echo = TRUE,
message = FALSE,
warning = FALSE,
results = "hold")
library(CONICSmat)
hist1 <- plotHistogram(cnv_est[, cand_regions],
as.matrix(pdac@assays$SCT@data),
clusters = 2,
zscoreThreshold = 3,
patients = pdac$sample)
